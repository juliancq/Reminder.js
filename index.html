<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@500&display=swap');
    </style>
    <style>
        :root {

            --primary: rgb(113 82 188);
            --secondary: rgb(223, 215, 215);
            --dark-primary: rgb(66 42 121);
            --red: rgb(170 57 57);
        }

        * {
            margin: 0;
            font-family: 'DM Sans', sans-serif;
        }

        html,
        body,
        #app {
            min-height: 100vh;
        }

        .flex {

            display: flex;
        }

        .w-100 {

            width: 100%;
        }

        #app {}

        #navbar {

            width: 20%;
            background-color: var(--primary);
            display: flex;
            color: white;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }

        #nav-title {

            justify-content: space-around;
            padding: 50px 0 60px;
            font-size: 30px;
        }

        #nav-item {
            width: 100%;
            text-align: center;
            padding: 10px;
        }

        #nav-item:hover {

            z-index: 98;
            cursor: pointer;

        }

        .selected-item {
            border-top-left-radius: 200px 200px;
            border-bottom-left-radius: 200px 200px;
            transform: translateX(50px);
            background-color: var(--secondary);
            color: var(--primary);
        }

        .content-light {

            z-index: 99;
            width: 80%;
            background-color: var(--secondary);
            padding: 50px;
            margin: 0 auto;
        }

        .content-dark {

            z-index: 99;
            width: 80%;
            background-color: var(--dark-primary);
            color: var(--secondary);
            padding: 50px;
            margin: 0 auto;
        }

        #content-header {

            display: flex;
            justify-content: center;
            font-size: 35px;
        }

        ul {
            padding: 0;
        }

        .task {

            list-style-type: none;
            margin: 30px 30px 0px 30px;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        input[type=text] {
            border: none;
            background: inherit;
            font: inherit;
            outline: none;
            color: inherit;
            text-align: center;
        }

        input[type=checkbox] {

            height: 25px;
            width: 25px;
            border: none;
            line-height: 25px;
            margin: 0 10px 0 0;
        }

        .add-btn {
            display: flex;
            justify-content: center;
        }

        button {

            background-color: var(--primary);
            color: var(--secondary);
            padding: 10px;
            border: none;
            cursor: pointer;
            border-radius: 10%;
            font-size: 18px;
            display: inline;
        }

        .task-buttons {

            display: flex;
            align-items: center;
        }

        .danger-btn {

            font-size: 14px;
            padding: 8px;
            background-color: var(--red)
        }

        #add-btn {

            margin-top: 30px;
        }

        #add-category-btn {

            z-index: 9999;
            position: fixed;
            left: 10px;
            bottom: 10px;
        }

        #right-bar {
            z-index: 9999;
            position: fixed;
            right: 10px;
            bottom: 10px;
        }
    </style>
    <title>Document</title>
</head>

<body>
    <div id="app" class="flex">

        <div id="navbar">
            <div id="nav-title" class="flex w-100">
                <div>{{username}}</div>
                <div>{{pfp}}</div>
            </div>
            <div id="nav-item" v-for="(category,i) of categories" :key="category.id"
                :class="{'selected-item' : selected == i}" @click="selectCategory(i)">

                {{category.title}}
            </div>


        </div>
        <div :class="nightmode ? 'content-dark' : 'content-light'">
            <div v-if="selected != -1">
                <h1 id="content-header">
                    <input type="text" v-model="categories[selected].title">
                </h1>
                <ul>
                    <li class="task" v-for="(item, i) of categories[selected].items" :key="i">
                        <input type="text" v-model="item.title" @keyup.enter="addTask()" :ref="(i == categories[selected].items.length -1) ? 'last' : ''">
                        <div class="task-buttons">
                            <input type="checkbox" v-model="item.done">
                            <button class="danger-btn" style="cursor:pointer" @click="deleteTask(i)">Delete</button>
                        </div>
                    </li>
                </ul>
                <div class="add-btn">
                    <button id="add-btn" @click="addTask()">Add</button>
                </div>
            </div>

        </div>
        <button id="add-category-btn" @click="addCategory()">
            ‚ûï
        </button>
        <div id="right-bar">
            <button v-if="selected != -1" @click="deleteCategory()">
                ‚ò†Ô∏è
            </button>
            <button v-if="selected != -1" @click="configCategory()">
                ‚öôÔ∏è
            </button>
            <button @click="toggleNightMode()">
                üåô
            </button>
            <button @click="saveUser(userId)">
                üíæ
            </button>
        </div>

    </div>

</body>

</html>
<script>
    const app = new Vue({

        el: "#app",
        data() {
            return {
                // username: "John Doe",
                // pfp: "üë®‚Äçü¶≥",
                // categories : [
                //                 {
                //                     id: 0,
                //                     title : 'To do',
                //                     color : null,
                //                     items: [
                //                         {

                //                             type : 0,
                //                             title : "Read a book",
                //                             done : false,
                //                         },
                //                         {

                //                             type : 1,
                //                             title : "Read two books",
                //                             done : false,
                //                         },
                //                         {

                //                             type : 2,
                //                             title : "Read three books",
                //                             done : false,
                //                         }
                //                     ],
                //                     editable: false
                //                 },
                //                 {
                //                     id: 1,
                //                     title : 'Market',
                //                     color: null,
                //                     items: [],
                //                     editable: false
                //                 },
                //                 {
                //                     id: 2,
                //                     title : 'Important',
                //                     color : null,
                //                     items: [],
                //                     editable: false
                //                 },
                //                 {
                //                     id: 3,
                //                     title : 'Music',
                //                     color: null,
                //                     items: [],
                //                     editable: false
                //                 }
                //             ],
                username : "",
                userId: 2327,
                categories: [],
                selected: -1,
                nightmode: true


            }
        },
        methods: {

            selectCategory(index) {

                this.categories[index].editable = false;
                this.selected = index;
            },

            addCategory(title = "Random title") {

                this.categories.push({
                    title,
                    color: null,
                    items: [],
                    editable: false
                })
            },

            setEditable(index) {
                this.categories[index].title = "";
                this.categories[index].editable = true;
            },

            configCategory() {

                alert("...");
            },

            deleteCategory() {

                if (confirm("Are u Sure?")) this.categories.splice(this.selected, 1)
                this.selected = -1;

            },


            addTask() {

                this.categories[this.selected].items.push({
                    title: "New task",
                    done: false
                })
                this.$forceUpdate();
                
                setTimeout(()=>{
                    this.$refs.last[0].focus()
                }, 0)      
            },

            deleteTask(index) {


                this.categories[this.selected].items.splice(index, 1)
                this.$forceUpdate();
            },

            toggleNightMode() {

                this.nightmode = !this.nightmode
            },


            loadUser(userId) {

                let data = this.GETData(userId)
                console.log(data);
                this.categories = data?.categories
                this.username = data?.username;
                this.pfp = data?.pfp;
            },

            saveUser(userId) {

                this.POSTData(userId, {
                    categories: this.categories,
                    username: this.username,
                    pfp: this.pfp
                })
            },

            POSTData(userId, data) {

                localStorage.setItem(userId, JSON.stringify(data));
            },

            GETData(userId) {

                return JSON.parse(localStorage.getItem(userId) || "{}")
            }
        },
        created() {

            this.loadUser(this.userId);
            console.log("created")
            this.saveUser(this.userId)
        }
    })
</script>